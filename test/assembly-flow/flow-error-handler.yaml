# This file contains testcases for the local error handler.

context:
  foo: ${request.headers['x-foo-hdr']}

assembly:
  execute:
    - if:
        condition: '$(foo)'
        execute:
          - throw:
              name: 'code$(foo)'

        catch:
          - errors:
              - 'code50'
            execute:
              - message-mediation:
                  target: context.response
                  value: '{ status: 200, message: "The minor error is recovered." }'
              - response:
                  payload: context.response

          - errors:
              - 'code300'
              - 'code400'
              - 'code500'
              - 'code600'
            execute:
              - throw:
                  name: 'fault$(foo)'

    - activity-log:
        content: dummy

  catch:
    - errors:
        - 'fault300'
        - 'fault400'
      execute:
        - response:
            payload: '{ status: 500, message: "Found a major error." }'

    - errors:
        - 'fault500'
        - 'fault600'
      execute:
        - response:
            payload: '{ status: 500, message: "Found a critical error." }'

    - default:
        - message-mediation:
            target: context.response
            value: '{ status: 500, message: "Unknown error." }'
        - response:
            payload: context.response
